================================================================================
QUANTIZATION FORMAT DETECTION EXPERIMENT - VERIFICATION (teacher-forcing)
================================================================================

System: 0ce493a31677
GPU: NVIDIA H100 80GB HBM3
vLLM: 0.11.2
PyTorch: 2.9.0+cu128
CUDA: 12.8

Configurations:
  awq: Qwen/Qwen3-8B-AWQ (quant=awq)
  awq_marlin: Qwen/Qwen3-8B-AWQ (quant=awq_marlin)
  gptq_marlin: AlphaGaO/Qwen3-8B-GPTQ (quant=gptq_marlin)

Reference file: INT4_A100_generation.json

Loading reference file...
Reference GPU: NVIDIA A100-SXM4-80GB
Verifier GPU:  NVIDIA H100 80GB HBM3

================================================================================
ENVIRONMENT VALIDATION
================================================================================

Critical dependencies:
  ✓ vllm_version: 0.11.2
  ✗ torch_version: reference=2.9.1+cu128, verifier=2.9.0+cu128
  ✓ cuda_version: 12.8

Expected differences (hardware):
  ✓ gpu_name: reference=NVIDIA A100-SXM4-80GB, verifier=NVIDIA H100 80GB HBM3
  ✓ hostname: reference=637c3157512e, verifier=0ce493a31677

⚠ ENVIRONMENT MISMATCHES DETECTED
  Results may be affected by software differences, not just hardware.

Loaded equivalent pairs from reference:
  Prefill: []
  Decode: []

================================================================================
VERIFYING WITH: awq
================================================================================
Loading model: Qwen/Qwen3-8B-AWQ
  Quantization: awq
  Dtype: float16

  Claimed config: awq
    ref_0 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.41e-02, Decode: 3.46e-02
    ref_1 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 5.70e-02, Decode: 2.82e-02
    ref_2 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.12e-02, Decode: 2.54e-02
    ref_3 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.20e-02, Decode: 4.66e-02

  Claimed config: awq_marlin
    ref_0 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.86e-02, Decode: 4.33e-02
    ref_1 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.26e-02, Decode: 1.98e-02
    ref_2 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.44e-02, Decode: 6.72e-03
    ref_3 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 7.11e-02, Decode: 4.30e-02

  Claimed config: gptq_marlin
    ref_0 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.72e+00, Decode: 3.24e+00
    ref_1 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.80e+00, Decode: 2.39e+00
    ref_2 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.85e+00, Decode: 2.21e+00
    ref_3 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.27e+00, Decode: 2.40e+00

================================================================================
VERIFYING WITH: awq_marlin
================================================================================
Loading model: Qwen/Qwen3-8B-AWQ
  Quantization: awq_marlin
  Dtype: float16

  Claimed config: awq
    ref_0 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 6.56e-02, Decode: 1.26e-02
    ref_1 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 5.25e-02, Decode: 4.43e-02
    ref_2 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.96e-02, Decode: 2.19e-02
    ref_3 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.61e-02, Decode: 5.01e-02

  Claimed config: awq_marlin
    ref_0 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 8.24e-02, Decode: 2.42e-02
    ref_1 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.50e-02, Decode: 4.63e-02
    ref_2 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.09e-02, Decode: 2.20e-02
    ref_3 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 6.35e-02, Decode: 2.65e-02

  Claimed config: gptq_marlin
    ref_0 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.70e+00, Decode: 3.23e+00
    ref_1 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.79e+00, Decode: 2.38e+00
    ref_2 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.87e+00, Decode: 2.24e+00
    ref_3 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.26e+00, Decode: 2.39e+00

================================================================================
VERIFYING WITH: gptq_marlin
================================================================================
Loading model: AlphaGaO/Qwen3-8B-GPTQ
  Quantization: gptq_marlin
  Dtype: float16

  Claimed config: awq
    ref_0 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.74e+00, Decode: 2.55e+00
    ref_1 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.01e+00, Decode: 2.07e+00
    ref_2 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.01e+00, Decode: 1.90e+00
    ref_3 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.26e+00, Decode: 2.86e+00

  Claimed config: awq_marlin
    ref_0 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.73e+00, Decode: 2.56e+00
    ref_1 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 3.98e+00, Decode: 2.06e+00
    ref_2 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.01e+00, Decode: 1.89e+00
    ref_3 (off):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.28e+00, Decode: 2.86e+00

  Claimed config: gptq_marlin
    ref_0 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 2.29e-02, Decode: 2.26e-02
    ref_1 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 6.34e-02, Decode: 1.95e-02
    ref_2 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 4.14e-02, Decode: 4.16e-02
    ref_3 (diag):      Prompt: 8067, Gen: 100 → verified
      Prefill: 5.51e-02, Decode: 3.91e-02

================================================================================
CROSS-HARDWARE QUANTIZATION DETECTABILITY (PREFILL)
================================================================================

--- ref_0 ---
                       awq   awq_marlin  gptq_marlin
         awq     4.41e-02     6.56e-02     4.74e+00 
  awq_marlin     4.86e-02     8.24e-02     4.73e+00 
 gptq_marlin     4.72e+00     4.70e+00     2.29e-02 

--- ref_1 ---
                       awq   awq_marlin  gptq_marlin
         awq     5.70e-02     5.25e-02     4.01e+00 
  awq_marlin     3.26e-02     3.50e-02     3.98e+00 
 gptq_marlin     3.80e+00     3.79e+00     6.34e-02 

--- ref_2 ---
                       awq   awq_marlin  gptq_marlin
         awq     4.12e-02     3.96e-02     4.01e+00 
  awq_marlin     4.44e-02     3.09e-02     4.01e+00 
 gptq_marlin     3.85e+00     3.87e+00     4.14e-02 

--- ref_3 ---
                       awq   awq_marlin  gptq_marlin
         awq     4.20e-02     3.61e-02     4.26e+00 
  awq_marlin     7.11e-02     6.35e-02     4.28e+00 
 gptq_marlin     4.27e+00     4.26e+00     5.51e-02 

================================================================================
AGGREGATE (average across references):
  Rows = claimed config, Cols = verified config
================================================================================
                       awq   awq_marlin  gptq_marlin
         awq     4.61e-02     4.85e-02     4.25e+00 
  awq_marlin     4.92e-02     5.29e-02     4.25e+00 
 gptq_marlin     4.16e+00     4.15e+00     4.57e-02 

================================================================================
SNR ANALYSIS
================================================================================

Diagonal (baseline = cross-hardware, same config):
  Mean: 4.82e-02

Off-diagonal (all pairs):
  Count: 6
  Mean: 2.82e+00
  SNR (all): 58.44×

Off-diagonal (meaningful pairs only):
  Count: 6
  Mean: 2.82e+00
  SNR (meaningful): 58.44×

================================================================================
PAIRWISE SNR ANALYSIS
================================================================================

For each pair (A, B): signal = distance(A→B), noise = diagonal baseline
SNR = signal / noise_floor

  awq vs awq_marlin:
    Signal: 4.88e-02, Noise: 4.95e-02
    SNR: 1.0× → NOT RELIABLY DETECTABLE
  awq vs gptq_marlin:
    Signal: 4.21e+00, Noise: 4.59e-02
    SNR: 91.7× → CLEARLY DETECTABLE
  awq_marlin vs gptq_marlin:
    Signal: 4.20e+00, Noise: 4.93e-02
    SNR: 85.2× → CLEARLY DETECTABLE

----------------------------------------
PAIRWISE SNR SUMMARY TABLE
----------------------------------------
Pair                               Signal      Noise      SNR
------------------------------------------------------------
awq_vs_gptq_marlin               4.21e+00   4.59e-02     91.7×
awq_marlin_vs_gptq_marlin        4.20e+00   4.93e-02     85.2×
awq_vs_awq_marlin                4.88e-02   4.95e-02      1.0×

================================================================================
CROSS-HARDWARE QUANTIZATION DETECTABILITY (DECODE)
================================================================================

--- ref_0 ---
                       awq   awq_marlin  gptq_marlin
         awq     3.46e-02     1.26e-02     2.55e+00 
  awq_marlin     4.33e-02     2.42e-02     2.56e+00 
 gptq_marlin     3.24e+00     3.23e+00     2.26e-02 

--- ref_1 ---
                       awq   awq_marlin  gptq_marlin
         awq     2.82e-02     4.43e-02     2.07e+00 
  awq_marlin     1.98e-02     4.63e-02     2.06e+00 
 gptq_marlin     2.39e+00     2.38e+00     1.95e-02 

--- ref_2 ---
                       awq   awq_marlin  gptq_marlin
         awq     2.54e-02     2.19e-02     1.90e+00 
  awq_marlin     6.72e-03     2.20e-02     1.89e+00 
 gptq_marlin     2.21e+00     2.24e+00     4.16e-02 

--- ref_3 ---
                       awq   awq_marlin  gptq_marlin
         awq     4.66e-02     5.01e-02     2.86e+00 
  awq_marlin     4.30e-02     2.65e-02     2.86e+00 
 gptq_marlin     2.40e+00     2.39e+00     3.91e-02 

================================================================================
AGGREGATE (average across references):
  Rows = claimed config, Cols = verified config
================================================================================
                       awq   awq_marlin  gptq_marlin
         awq     3.37e-02     3.22e-02     2.34e+00 
  awq_marlin     2.82e-02     2.97e-02     2.34e+00 
 gptq_marlin     2.56e+00     2.56e+00     3.07e-02 

================================================================================
SNR ANALYSIS
================================================================================

Diagonal (baseline = cross-hardware, same config):
  Mean: 3.14e-02

Off-diagonal (all pairs):
  Count: 6
  Mean: 1.64e+00
  SNR (all): 52.40×

Off-diagonal (meaningful pairs only):
  Count: 6
  Mean: 1.64e+00
  SNR (meaningful): 52.40×

================================================================================
PAIRWISE SNR ANALYSIS
================================================================================

For each pair (A, B): signal = distance(A→B), noise = diagonal baseline
SNR = signal / noise_floor

  awq vs awq_marlin:
    Signal: 3.02e-02, Noise: 3.17e-02
    SNR: 1.0× → NOT RELIABLY DETECTABLE
  awq vs gptq_marlin:
    Signal: 2.45e+00, Noise: 3.22e-02
    SNR: 76.1× → CLEARLY DETECTABLE
  awq_marlin vs gptq_marlin:
    Signal: 2.45e+00, Noise: 3.02e-02
    SNR: 81.1× → CLEARLY DETECTABLE

----------------------------------------
PAIRWISE SNR SUMMARY TABLE
----------------------------------------
Pair                               Signal      Noise      SNR
------------------------------------------------------------
awq_marlin_vs_gptq_marlin        2.45e+00   3.02e-02     81.1×
awq_vs_gptq_marlin               2.45e+00   3.22e-02     76.1×
awq_vs_awq_marlin                3.02e-02   3.17e-02      1.0×

================================================================================
PREFILL vs DECODE COMPARISON
================================================================================
Prefill SNR (meaningful): 58.44×
Decode SNR (meaningful):  52.40×

✓ Results saved to: /workspace/experiments/quant_verify_20251130_094250.json

================================================================================
EXPERIMENT COMPLETE
================================================================================

