================================================================================
TENSOR PARALLELISM DETECTABILITY EXPERIMENT
================================================================================

Hostname: 552ddec725ff
GPUs: 4x NVIDIA H100 80GB HBM3
vLLM: 0.11.2
Model: Qwen/Qwen3-14B
TP sizes to test: [1, 2, 4]
Mode: CROSS-HARDWARE

Loading reference: A100_TP_generation_10k_context.json
Loaded 3 prompts from reference

================================================================================
TENSOR PARALLEL = 1
================================================================================
Loading model with TP=1...

================================================================================
REPRODUCIBILITY TEST
================================================================================
Running same prompt 5 times...
  Run 1: done
  Run 2: done
  Run 3: done
  Run 4: done
  Run 5: done

✓ REPRODUCIBILITY TEST PASSED
  All 5 runs identical
  Max logprob difference: 0.00e+00
  ref_0: 3 positions captured
  ref_1: 3 positions captured
  ref_2: 3 positions captured

================================================================================
TENSOR PARALLEL = 2
================================================================================
Loading model with TP=2...
  ref_0: 3 positions captured
  ref_1: 3 positions captured
  ref_2: 3 positions captured

================================================================================
TENSOR PARALLEL = 4
================================================================================
Loading model with TP=4...
  ref_0: 3 positions captured
  ref_1: 3 positions captured
  ref_2: 3 positions captured

================================================================================
WITHIN-HARDWARE TP COMPARISON (PREFILL)
================================================================================

--- ref_0 ---

Logprobs (L2 distance):
       TP=  1 TP=  2 TP=  4
TP=1    0.00e+00   2.39e-01   3.46e-01
TP=2    2.39e-01   0.00e+00   3.69e-01
TP=4    3.46e-01   3.69e-01   0.00e+00

--- ref_1 ---

Logprobs (L2 distance):
       TP=  1 TP=  2 TP=  4
TP=1    0.00e+00   1.72e-01   2.01e-01
TP=2    1.72e-01   0.00e+00   3.07e-01
TP=4    2.01e-01   3.07e-01   0.00e+00

--- ref_2 ---

Logprobs (L2 distance):
       TP=  1 TP=  2 TP=  4
TP=1    0.00e+00   3.48e-01   2.59e-01
TP=2    3.48e-01   0.00e+00   2.66e-01
TP=4    2.59e-01   2.66e-01   0.00e+00

================================================================================
AGGREGATE (average across references):
================================================================================

Logprobs (L2 distance):
       TP=  1 TP=  2 TP=  4
TP=1    0.00e+00   2.53e-01   2.69e-01
TP=2    2.53e-01   0.00e+00   3.14e-01
TP=4    2.69e-01   3.14e-01   0.00e+00

Diagonal (same TP): 0.00e+00
Off-diagonal (different TP): 2.78e-01
SNR: inf

================================================================================
CROSS-HARDWARE COMPARISON
================================================================================

Environment comparison:
  Reference GPU: NVIDIA A100-SXM4-80GB
  Verifier GPU:  NVIDIA H100 80GB HBM3
  vllm_version: 0.11.2 vs 0.11.2 ✓
  torch_version: 2.9.0+cu128 vs 2.9.0+cu128 ✓
  cuda_version: 12.8 vs 12.8 ✓

================================================================================
CROSS-HARDWARE TP COMPARISON (PREFILL)
================================================================================
  Rows = reference TP, Cols = verifier TP

--- ref_0 ---

Logprobs (L2 distance):
       v_TP= 1 v_TP= 2 v_TP= 4
r_TP=1   3.21e-01   3.34e-01   2.92e-01
r_TP=2   2.46e-01   3.42e-01   4.54e-01
r_TP=4   2.77e-01   4.07e-01   4.13e-01

--- ref_1 ---

Logprobs (L2 distance):
       v_TP= 1 v_TP= 2 v_TP= 4
r_TP=1   3.34e-01   3.44e-01   3.23e-01
r_TP=2   1.45e-01   1.33e-01   2.70e-01
r_TP=4   2.29e-01   2.24e-01   3.07e-01

--- ref_2 ---

Logprobs (L2 distance):
       v_TP= 1 v_TP= 2 v_TP= 4
r_TP=1   4.27e-01   1.87e-01   2.83e-01
r_TP=2   3.29e-01   2.24e-01   2.03e-01
r_TP=4   2.16e-01   3.44e-01   3.43e-01

================================================================================
AGGREGATE (average across references):
================================================================================

Logprobs (L2 distance):
       v_TP= 1 v_TP= 2 v_TP= 4
r_TP=1   3.60e-01   2.88e-01   2.99e-01
r_TP=2   2.40e-01   2.33e-01   3.09e-01
r_TP=4   2.41e-01   3.25e-01   3.55e-01

================================================================================
SNR ANALYSIS
================================================================================

Diagonal (baseline = cross-hardware, same TP):
  Logprobs: 3.16e-01

Off-diagonal (different TP):
  Logprobs - Mean: 2.84e-01, SNR: 0.90×

Saved to: /workspace/experiments/tp_cross_hardware_20251126_235308.json
